{"version":3,"sources":["iframe/js/countdown.js","iframe/js/script.js"],"names":["Countdown","params","this","target","DOMNode","document","querySelector","date","interval","requestAnimationFrame","bind","tick","start","prototype","destroy","stop","pad","num","window","setTimeout","setInterval","clearInterval","now","Date","diff","Math","max","render","days","floor","hours","minutes","seconds","textContent","getOrg","org","orgs","dp","code","name","url","donate","fp","fftf","hasOwnProperty","coinToss","random","getTheme","theme","themeObj","className","logos","headline","body","keys","Object","k","length","renderContent","classList","add","img","fragment","createDocumentFragment","i","createElement","setAttribute","appendChild","getElementById","paragraph","bodyFragment","bodyCopy","split","learnMore","options","addCloseListeners","addEventListener","e","preventDefault","sendMessage","requestType","data","BFTN_IFRAME_MSG","parent","postMessage","initGoogleAnalytics","s","o","g","r","a","m","GoogleAnalyticsObject","q","push","arguments","l","getElementsByTagName","async","src","parentNode","insertBefore","ga","transitionTimer","loading","main","callScript","animations","debug","init","showCallScript","clearTimeout","remove","setActionCookie","val","expires","actionCookieExpires","onCall","call","donateLinks","querySelectorAll","uncloseable","disableGoogleAnalytics","navigator","doNotTrack","footer","formData","FormData","xhr","XMLHttpRequest","open","getAttribute","referrer","send","log","console","apply","BFTN_WIDGET_MSG","modalAnimation"],"mappings":"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","file":"main.js","sourcesContent":["'use strict';\n\nfunction Countdown(params) {\n  this.target = params.target;\n\n  this.DOMNode = document.querySelector(this.target);\n\n  if (this.DOMNode) {\n    this.date = params.date;\n    this.interval = null;\n    this.requestAnimationFrame = this.requestAnimationFrame.bind(this);\n    this.tick = this.tick.bind(this);\n\n    this.start();\n  }\n}\n\nCountdown.prototype.destroy = function() {\n  this.stop();\n\n  delete this.date;\n  delete this.tick;\n};\n\nCountdown.prototype.pad = function(num) {\n  return num > 9 ? num : '0' + num;\n};\n\nCountdown.prototype.requestAnimationFrame = function() {\n  var request = window.requestAnimationFrame || setTimeout;\n  request(this.tick);\n};\n\nCountdown.prototype.start = function() {\n  this.stop();\n  this.requestAnimationFrame();\n  this.interval = setInterval(this.requestAnimationFrame, 1000);\n};\n\nCountdown.prototype.stop = function() {\n  clearInterval(this.interval);\n};\n\nCountdown.prototype.tick = function() {\n  var now = Date.now();\n  var diff = Math.max(0, this.date - now);\n\n  this.render(diff);\n\n  if (diff === 0) {\n    this.destroy();\n    return;\n  }\n};\n\nCountdown.prototype.render = function(diff) {\n  var DAY = (1000 * 60 * 60 * 24);\n  var HOUR = (1000 * 60 * 60);\n  var MINUTE = (1000 * 60);\n  var SECOND = (1000);\n\n  var days = Math.floor(diff / DAY);\n  diff -= days * DAY;\n\n  var hours = Math.floor(diff / HOUR);\n  diff -= hours * HOUR;\n\n  var minutes = Math.floor(diff / MINUTE);\n  diff -= minutes * MINUTE;\n\n  var seconds = Math.floor(diff / SECOND);\n  diff -= seconds * SECOND;\n\n  this.DOMNode.querySelector('.days').textContent = this.pad(days);\n  this.DOMNode.querySelector('.hours').textContent = this.pad(hours);\n  this.DOMNode.querySelector('.minutes').textContent = this.pad(minutes);\n  this.DOMNode.querySelector('.seconds').textContent = this.pad(seconds);\n};\n","'use strict';\n\n(function() {\n  var transitionTimer;\n\n  var loading = document.getElementById('loading');\n  var main = document.getElementById('main');\n  var callScript = document.getElementById('script');\n\n  function getOrg(org) {\n    function getRandomOrg() {\n      var coinToss = Math.random();\n\n      if (coinToss < .20) {\n        return 'fp';\n      } else if (coinToss < .60) {\n        return 'dp';\n      } else {\n        return 'fftf';\n      }\n    }\n\n    var orgs = {\n      'dp': {\n        code: 'dp',\n        name: 'Demand Progress',\n        url: 'https://demandprogress.org/',\n        donate: 'https://secure.actblue.com/donate/nndayofaction?refcode=20170712-bftn'\n      },\n      'fp': {\n        code: 'fp',\n        name: 'Free Press Action Fund',\n        url: 'https://www.freepress.net/',\n        donate: 'https://freepress.actionkit.com/donate/single/'\n      },\n      'fftf': {\n        code: 'fftf',\n        name: 'Fight for the Future',\n        url: 'https://www.fightforthefuture.org/',\n        donate: 'https://donate.fightforthefuture.org/'\n      }\n    };\n\n    return orgs.hasOwnProperty(org) ? orgs[org] : orgs[getRandomOrg()];\n  }\n\n  function getTheme(theme) {\n    var themeObj;\n\n    switch(typeof theme === 'string' ? theme : '') {\n      case 'money':\n        themeObj = {\n          className: theme,\n          logos: ['images/money.png'],\n          headline: 'Please upgrade your plan to proceed.',\n          body: 'Well, not yet. But without net neutrality, cable companies could censor websites based on their content, or to favor their own business partners. Congress can stop them, but only if we flood them with calls right now.'\n        };\n        break;\n      case 'stop':\n        themeObj = {\n          className: theme,\n          logos: ['images/stop.png'],\n          headline: 'This site has been blocked by your ISP.',\n          body: 'Well, not yet. But without net neutrality, cable companies could censor websites, favoring their own business partners. We can stop them and keep the Internet open, fast, and awesome if we all contact the U.S. Congress and the FCC, but we only have a few days left.'\n        };\n        break;\n      case 'slow':\n        themeObj = {\n          className: theme,\n          logos: ['images/slow.svg'],\n          headline: 'Sorry, we\\'re stuck in the slow lane.',\n          body: 'Well, not yet. But the FCC is about to vote to get rid of net neutrality, letting ISPs slow sites like this to a crawl and charge everyone extra fees. Congress can stop them, but only if we flood them with calls right now.'\n        };\n        break;\n      case 'without':\n        themeObj = {\n          className: theme,\n          logos: ['images/slow.svg', 'images/stop_gradient.png', 'images/money_gradient.png'],\n          headline: 'This is the web without net neutrality.',\n          body: 'The FCC is about to vote to get rid of net neutrality. Without it, sites like this could be censored, slowed down, or forced to charge extra fees. Congress can stop them, but only if we flood them with calls right now.'\n        };\n        break;\n      case 'countdown':\n      default:\n        themeObj = {\n          className: 'countdown',\n          logos: [],\n          headline: 'URGENT!',\n          body: 'The FCC is about to announce a vote on its plan to kill net neutrality. We have just days to stop censorship, throttling, and extra fees online. Congress needs to hear from Internet users like you right now.'\n        };\n        break;\n    }\n\n    if (typeof theme == 'object') {\n      var keys = Object.keys(theme);\n      for (var k = 0; k < keys.length; k++) {\n        themeObj[keys[k]] = theme[keys[k]];\n      }\n    }\n\n    return themeObj;\n  }\n\n  function renderContent(theme) {\n    document.body.classList.add(theme.className);\n\n    // Render logos\n    var fragment = document.createDocumentFragment();\n    var img;\n\n    for (var i = 0; i < theme.logos.length; i++) {\n      img = document.createElement('img');\n      img.setAttribute('src', theme.logos[i]);\n      fragment.appendChild(img);\n    }\n\n    document.getElementById('logos').appendChild(fragment);\n\n    // Render headline and body copy\n    document.getElementById('headline').textContent = theme.headline;\n\n    var bodyFragment = document.createDocumentFragment();\n    var bodyCopy = theme.body.split('\\n');\n    var paragraph;\n\n    for (var i = 0; i < bodyCopy.length; i++) {\n      paragraph = document.createElement('p');\n      paragraph.textContent = bodyCopy[i];\n      bodyFragment.appendChild(paragraph);\n    }\n    \n    var learnMore = document.createElement('a');\n    learnMore.setAttribute('href', 'https://www.battleforthenet.com/#widget-learn-more');\n    learnMore.setAttribute('target', '_blank');\n    learnMore.textContent = 'Learn more.';\n\n    // Append link to last paragraph in body copy.\n    paragraph.textContent += ' ';\n    paragraph.appendChild(learnMore);\n\n    document.getElementById('content').appendChild(bodyFragment);\n\n    if (theme.className === 'countdown' && typeof Countdown === 'function') {\n      new Countdown({\n        target: '#countdown',\n        date: this.options.date\n      });\n    }\n  }\n\n  function addCloseListeners() {\n    // Add close button listener.\n    document.getElementById('close').addEventListener('mousedown', function(e) {\n      e.preventDefault();\n      sendMessage('stop');\n    });\n\n    document.getElementById('background').addEventListener('mousedown', function(e) {\n      // Ignore events that propagate up\n      if (e.target == document.getElementById('background')) sendMessage('stop');\n    });\n  }\n\n  function sendMessage(requestType, data) {\n    data || (data = {});\n    data.requestType = requestType;\n    data.BFTN_IFRAME_MSG = true;\n    parent.postMessage(data, '*');\n  }\n\n  function initGoogleAnalytics() {\n    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\n\n    if (typeof ga !== 'undefined') {\n      ga('create', 'UA-26576645-40', 'auto');\n      ga('send', 'pageview');\n    }\n  }\n\n  var animations = {\n    main: {\n      options: {\n        debug: false,\n      },\n      init: function(options) {\n        var keys = Object.keys(options);\n        for (var k = 0; k < keys.length; k++) {\n          this.options[keys[k]] = options[keys[k]];\n        }\n\n        renderContent.call(this, getTheme(this.options.theme));\n\n        var org = getOrg(this.options.org);\n        var donateLinks = document.querySelectorAll('a.donate');\n        if (donateLinks.length) {\n          for (var i = 0; i < donateLinks.length; i++) {\n            if (org.donate) donateLinks[i].setAttribute('href', org.donate);\n            donateLinks[i].addEventListener('click', setActionCookie.bind(this));\n          }\n        }\n\n        if (this.options.uncloseable) {\n          document.getElementById('close').classList.add('hidden');\n        } else {\n          addCloseListeners();\n        }\n\n        if (!(this.options.disableGoogleAnalytics || navigator.doNotTrack)) initGoogleAnalytics();\n\n        function onError(e) {\n          // TODO: Error handling\n        }\n\n        function showCallScript(e) {\n          if (transitionTimer) clearTimeout(transitionTimer);\n\n          if (callScript) callScript.classList.remove('invisible');\n          if (main) main.classList.add('invisible');\n          if (loading) loading.classList.add('hidden');\n        }\n\n        function setActionCookie() {\n          sendMessage('cookie', {\n            name: '_BFTN_WIDGET_ACTION',\n            val: 'true',\n            expires: this.options.actionCookieExpires\n          });\n        }\n\n        function onCall(e) {\n          if (transitionTimer) clearTimeout(transitionTimer);\n\n          // TODO: Error handling\n          // if (e && e.code >= 400) return onError(e);\n\n          setActionCookie.call(this);\n\n          if (loading) {\n            loading.addEventListener('transitionend', showCallScript);\n            loading.classList.add('invisible');\n          }\n\n          transitionTimer = setTimeout(showCallScript, 500);\n        }\n\n        var call = document.getElementById('call');\n        call.addEventListener('submit', function submitCall(e) {\n          e.preventDefault();\n\n          var footer = document.getElementById('footer');\n          if (footer) {\n            footer.classList.remove('hidden');\n            footer.classList.remove('invisible');\n          }\n\n          if (callScript) callScript.classList.remove('hidden');\n          if (main) main.classList.add('hidden');\n\n          var formData = new FormData(call);\n          var xhr = new XMLHttpRequest();\n\n          if (loading) {\n            loading.addEventListener('transitionend', onCall.bind(this));\n            loading.classList.remove('hidden');\n            loading.classList.remove('invisible');\n          }\n\n          transitionTimer = setTimeout(onCall.bind(this), 500);\n\n          xhr.open(call.getAttribute('method'), call.getAttribute('action') + '?ref=' + document.referrer, true);\n          xhr.send(formData);\n        }.bind(this));\n\n        return this;\n      },\n      log: function() {\n        if (this.options.debug) console.log.apply(console, arguments);\n      }\n    }\n  }\n\n  // Handle iframe messages\n  window.addEventListener('message', function(e) {\n    if (!e.data || !e.data.BFTN_WIDGET_MSG) return;\n\n    delete e.data.BFTN_WIDGET_MSG;\n\n    switch (e.data.requestType) {\n      case 'putAnimation':\n        animations[e.data.modalAnimation].init(e.data);\n        break;\n    }\n  });\n\n  // Start animation\n  sendMessage('getAnimation');\n})();\n"]}